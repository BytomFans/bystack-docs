---
id: docs_68
title: 基本数据结构
sidebar_label: 基本数据结构
---

## Integer

LEB128整型，最大值为0x7fffffffffffffffff（2^63 – 1），最小为0。varint63可以装入带符号的64位整型。

## String

带有LEB128前缀的二进制字符串，以字节为单位指定其长度。基础字符串的最大长度为0x7fffffff（2^31 – 1）。
空字符串编码为单字节0x00，一个字节字符串编码为两个字节0x01 0xNN，两个字节字符串编码为0x02 0xNN 0xMM，依此类推。

## Hash

把任意长度的输入（又叫做预映射， pre-image），通过散列算法，变换成固定长度的输出，该输出就是散列值。

## Pointer

`Pointer`编码为String32，并通过其ID标识另一个entry。`Pointer`限定可接受类型：`Pointer<X>`必须引用Entry类型`X`。
`Pointer`可以是`nil`（不指向任何Entry），在这种情况下，它由全零的32字节哈希表示：

     0x0000000000000000000000000000000000000000000000000000000000000000

## SHA3

SHA3指SHA3​​-256功能中定义[FIPS202](https://dx.doi.org/10.6028/NIST.FIPS.202)与固定长度的32字节输出。该散列函数在本规范中的所有数据结构和算法中都使用，除了SHA-512(请参阅[FIPS180](http://csrc.nist.gov/publications/fips/fips180-2/fips180-2withchangenotice.pdf)）在内部在Ed25519内部用作函数H（请参阅[RFC8032](https://tools.ietf.org/html/rfc8032)）。

## Program

Program封装了VM的版本以及该VM应该执行的字节码。

| 字段 | 类型 | 描述 | 
| --- | --- |--- |
| VM Version |	[Integer](#integer)	| 评估程序时要使用的VM版本 |
| Bytecode | [String](#string) | 要执行的程序代码 |

**Program验证**

**输入：**

-  程序
-  参数（字符串列表）
-  交易版本（整数）

**算法：**

1. 如果`VM Version`大于1：

- 如果交易版本为1，则验证失败。
- 如果交易版本大于1，则验证成功。

2. 如果`VM Version`等于1：

- 如果交易版本大于1，实例化VM version 1，并将初始状态和扩展标志设置为`true`。

- `Bytecode`用给定的参数评估。

- 如果程序评估成功，则验证成功。如果程序评估失败，则验证失败。

## Asset

**Asset定义**

| 字段 | 类型 | 描述 | 
| --- | --- |--- |
|Initial Block ID	| [String](#string) | 定义此资产的区块链的创世区块的ID|
|Issuance Program	| [Program](#program) |	发行此资产必须满足的程序|
|Asset Reference Data | [String](#string) |	该资产的引用数据（以前称为“资产定义”）的哈希值|

**Asset ID**

Asset ID是所有区块链中给定资产的全球唯一标识符。

Asset ID被定义为[SHA3-256](#sha3)所述的[Asset定义](#asset定义)：

    AssetID = SHA3-256(AssetDefinition)

**Asset Amount 1**

AssetAmount1结构体将资产的单位数量及其[asset ID](#asset-id)封装在一起。

| 字段 | 类型 | 描述 | 
| --- | --- |--- |
|AssetID | [String](#string) | [Asset ID](#asset-id)|
|Value | [Integer](#integer) | 参考asset的数量|

**Value Source 1**

一个Entry使用ValueSource引用其他Entry提供了它的价值。

| 字段 | 类型 | 描述 | 
| --- | --- |--- |
| Ref | Pointer<Issuance1/Spend1/Mux1> | 该ValueSource引用的上一个entry。 |
| Value | [AssetAmount1](#asset-amount-1) | 数量和资产ID包含于引用的entry。 |
| Position | [Integer](#integer) | 如果该source是[Mux](#mux1) entry，那么`Position`就是输出的索引。如果该source是[Issuance](#issuance1)或[Spend](#spend1) entry，那么`Position`一定是0。 |

**Value Destination 1**

Entry用ValueDestination引用其他Entry从当前Entry接收值。

| 字段 | 类型 | 描述 | 
| --- | --- |--- |
| Ref | Pointer<Output1/Retirement1/Mux1> | 该ValueSource引用的下一个ValueDestination。 |
| Value | AssetAmount1 | 数量和资产ID包含于引用的entry。 |
| Position | uint64 | 如果该destination是[Mux](#mux1) entry，那么`Position`就是一个mux的标号输入。如果不是，那么`Position`一定是0。 |



## 总结

protocol/tx.go
protocol/validation/tx.go
protocol/bc/bc.pb.go


protocol/bc/types/map.go
mapTx函数
type层coinbaseInput, issuanceInput, spendInput转换成ValueSource类型。
ValueSource转成mux类型。
mux转换为ValueDestination类型后，分为coinbase, issuance, spend，spendOutput。
ValueSource转换成Outputs，retirement。
TxHeader来自resultID和mux。
返回mux，TxHeader。

用mapTx函数分别把protocol/bc/type包下的交易数据结构转为protocol/bc包下Entry类型。
用checkValid验证每个Entry类型的各种资产输入输出总量是否相等。


