---
id: docs_29
title:  奖励发放工具
sidebar_label: 奖励发放工具
---

#### 准备工作

1. 获取vapor的源码，vapor源码地址：[vapor库](https://github.com/Bytom/vapor)
2. 合并utxo: 切换到 cmd/utxomerge, 参考：[readem文件](https://github.com/Bytom/vapor/blob/master/cmd/utxomerge/README.md)
3. 本地安装mysql数据库，同时倒入表结构。表结构所在目录:
   vapor/toolbar/vote_reward/database/dump_reward.sql

#### 配置文件

1. 切换到cmd/votereward 目录，在cmd/votereward下创建reward.json 文件
2. 配置文件内容如下：

**example:**

```
{
  "node_ip": "http://127.0.0.1:9889",   //个人节点的api的IP地址
  "chain_id": "mainnet",                //侧链的网络类型：主网（mainnet）、测试网（testnet）、私有网络（solonet）
  "mysql": {                            //mysql配置
    "connection": {
       "host": "192.168.30.186",        //mysql服务地址
       "port": 3306,                    //mysql端口
       "username": "root",              //mysql用户名
       "password": "123456",            //mysql密码
       "database": "reward"             //创建的数据库名称
    },
    "log_mode": false                   //默认
    },
    "reward_config": {                  //收益计算以及分配配置
       "xpub": "9742a39a0bcfb5b7ac8f56f1894fbb694b53ebf58f9a032c36cc22d57a06e49e94ff7199063fb7a78190624fa3530f611404b56fc9af91dcaf4639614512cb64",         // 共识节点的公钥，从网页钱包的设置中获取（是节点公钥，不是账户公钥）
       "account_id": "bd775113-49e0-4678-94bf-2b853f1afe80",  //发送给投票人收益的钱包ID
       "password": "123456",            //钱包ID对应的密码
       "reward_ratio": 20,              //分配给投票人的收益比列
       "mining_address": "sp1qfpgjve27gx0r9t7vud8vypplkzytgrvqr74rwz"    //共识节点获取出块收益的地址,通过调用api接口获取:  curl -x POST http://127.0.0.1:9889/get-mining-address -d '{}'

    }
}
```

#### 收益工具使用

**1. 参数**

config_file: 配置文件，默认是reward.json，与启动命令在同一个目录
reward_start_height：计算收益区间的开始高度
reward_end_height：计算收益区间的结束高度

**注：reward_start_height、reward_end_height是1200(一轮共识出块的数量)的倍数，reward_start_height的最小值是1200，比如收益区间1200～3600计算的是0～2400范围的投票的收益。**

```
distribution of reward.
Usage:
  reward [flags]
Flags:
  --config_file string              config file. default: reward.json (default "reward.json")
  --h, --help                       help for reward
  --reward_end_height uint          The end height of the distributive income reward interval, It is a multiple of the dpos consensus cycle(1200). example: 2400
  --reward_start_height uint        The starting height of the distributive income reward interval, It is a multiple of the dpos consensus cycle(1200). example: 1200
```

**2、启动实例**

```
./votereward reward --reward_start_height 6000 --reward_end_height 7200
```

**注：如果报错：an error (Gas credit has been spent) is returned，是utxo需要合并，请使用utxo合并工具（参考准备工作第二步），如果出现其它错误，检查自己的配置文件参数。**
