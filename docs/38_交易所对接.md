---
id: docs_38
title: 交易所对接
sidebar_label: 交易所对接
---

为了方便交易所接入比原链，下面给出了集成管理UTXO的流程。

#### 节点部署维护升级

**1. Homebrew安装**

```
brew tap bytom/bytom && brew install bytom
```

**2. Docker安装**

获取Docker镜像

```
docker pull bytom/bytom:latest
```

初始化节点

```
docker run -v ~/Bytom:/root/.bytom bytom/bytom:latest bytomd init --chain_id mainnet
```

运行节点

```
docker run -d -p 46657:46657 -v ~/Bytom:/root/.bytom bytom/bytom:latest bytomd node --web.closed --auth.disable
```

**3. 二进制文件安装**

安装系统依赖库

```
sudo apt-get update
sudo apt-get install build-essential git unzip wget vim
```

下载并解压节点

```
wget https://mirrors.tuna.tsinghua.edu.cn/osdn/bytom/70718/bytom-1.0.8-linux.zip
unzip bytom-1.0.8-linux.zip
chmod +777 ./bytomd
```

启动并运行节点

```
./bytomd init --chain_id mainnet
./bytomd node --simd.enable
```


**4. 源码安装**

环境要求

- [Go](https://golang.org/doc/install) 版本1.8或者更高, 设置 `$GOPATH`

```bash
$ go version #查看golang版本是否符合要求
$ go env GOROOT GOPATH #获取环境变量
```
下载Bytom源代码

```bash
$ git clone https://github.com/Bytom/bytom.git $GOPATH/src/github.com/bytom
```

Makefile构建

```bash
$ make bytom-simd
```

编译支持Intel [SIMD](https://en.wikipedia.org/wiki/Streaming_SIMD_Extensionsl) 技术的Bytom客户端，需注意:

1. 如果使用_MacOS_llvm_  运行命令:`brew install llvm`.
2. 如果使用_Windows_mingw-w64_PATH_环境变量.

```bash
$ make release
```

编译多种版本的Bytom客户端,  步骤包括：

1. 编译相应操作系统环境下的_32位_64位_ `bytomd`, `bytomcli` and `miner`
2. 进行md5校验同时压缩相应二进制文件至 `target/` 目录. _MacOS_系统需要预先安装md5校验工具,运行命令 `brew install md5sha1sum`.

```bash
$ make release-all
```

编译所有平台下的多种版本Bytom客户端，步骤包括：

1. 编译各操作系统环境下的_32位_64位_ `bytomd`, `bytomcli` and `miner`, 包括_Windows_Linux_MacOS_.
2. 进行md5校验同时压缩相应二进制文件至 `target/` 目录. _MacOS_系统需要预先安装md5校验工具, 运行命令`brew install md5sha1sum`.

初始节点:

```bash
$ cd ./cmd/bytomd
$ ./bytomd init --chain_id testnet
```

有两个选项 `--chain_id`:

- `testnet`: 连接到测试网络.
- `mainnet`: 连接到主网.
- `solonet`: 连接到单机网络

运行该指令后，你会发现 `.bytomd` 在当前文件夹生产,然后就可以启动节点了。

启动节点

```bash
$ ./bytomd node --mining
```

下面是一些可用参数:

```
--auth.disable                Disable rpc access authenticate
      --mining                      Enable mining
      --p2p.dial_timeout int        Set dial timeout (default 3)
      --p2p.handshake_timeout int   Set handshake timeout (default 30)
      --p2p.laddr string            Node listen address.
      --p2p.max_num_peers int       Set max num peers (default 50)
      --p2p.pex                     Enable Peer-Exchange
      --p2p.seeds string            Comma delimited host:port seed nodes
      --p2p.skip_upnp               Skip UPNP configuration
      --prof_laddr string           Use http to profile bytomd programs
      --wallet.disable              Disable wallet
      --web.closed                  Lanch web browser or not
```

`bytomd` 节点运行后,你可以进行以下操作:

- 创建密钥,然后你可以创建账户和资产.
- 发送交易, 需要构建，签名和提交交易.
- 查询所有的信息, 比如可用的密钥，账户，余额和交易等等.

进入仪表盘：

```
$ open http://localhost:9888/
```

#### 创建地址

     如果使用RPC接口，参考创建钱包地址接口：[创建地址](https://www.yuque.com/ivyh2d/fo3png/snx3l6#create-account-receiver)。若使用以下语言的sdk,则参考sdk中的方法：
    1.如果使用的开发语言是java: [Java sdk](https://bytomfans.github.io/java-docs/start)
    2.如果使用的开发语言是php:  [Php sdk](https://bytomfans.github.io/php-docs/start)
    3.如果使用的开发语言是js: [Js sdk](https://bytomfans.github.io/node-docs/start)

#### 转账接口

比原链转账过程需要三步：构建交易、签署交易、提交交易。

1. 构建交易：构建交易需要接口：[build-transaction](https://www.yuque.com/ivyh2d/fo3png/snx3l6#build-transaction)
2. 签署交易:  签署交易需要接口：[sign-transaction](https://www.yuque.com/ivyh2d/fo3png/snx3l6#sign-transaction)
3. 提交交易:  提交交易需要接口：[submit-transaction](https://www.yuque.com/ivyh2d/fo3png/snx3l6#submit-transaction)

#### 监控交易，判断充值

用户发起充值之后，交易所判断用户充值的方法(确定充值是正确的成功的不可逆的，不分叉的，不是假充值)：

1. 交易所可以实时监控每个新产生区块，使用[get-block-hash](https://www.yuque.com/ivyh2d/fo3png/snx3l6#get-block-hash)[ ]()接口获取最新区块哈希;
2. 使用 [get-block](https://www.yuque.com/ivyh2d/fo3png/snx3l6#YMqZF) 接口获取该区块的所有交易列表;
3. 可以从交易列表中的交易输出中查找每个output 的目标地址、资产 ID和数额，与交易所数据库中的地址相比较，看该交易是否是用户充值;
4. 为了降低分叉行为带来的影响，可以使用 [get-block-count](https://www.yuque.com/ivyh2d/fo3png/snx3l6#get-block-count) 接口查询最新区块高度，与用户充值所对应的区块高度相比较，达到 6 个以上的区块高度差即可认定用户充值安全，该数值也可以根据不同交易所情况自行设定;
